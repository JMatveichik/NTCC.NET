name: Release .NET 6.0 Windows App

on:
  push:
    tags:
      - 'v*'

jobs:
  build-and-publish:
    runs-on: windows-latest  # Обязательно Windows!

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup .NET 6 SDK
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '6.0.x'
          
      - name: Check .NET version
        run: dotnet --info

      - name: List all projects
        run: dotnet sln NTCC.NET.sln list

      - name: Check project dependencies
        run: dotnet list NTCC.NET.Core/NTCC.NET.Core.csproj package
  
      - name: Restore NuGet packages
        run: |
             dotnet restore NTCC.NET.sln
             dotnet restore NTCC.NET.Core/NTCC.NET.Core.csproj
  
      - name: Build NTCC.NET (Windows)
        run: dotnet build NTCC.NET.sln --configuration Release

      - name: Pack artifacts
        run: dotnet pack --configuration Release --output ./artifacts

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            ./artifacts/*.nupkg
            **/bin/Release/**/*.exe  # Для Windows-приложений